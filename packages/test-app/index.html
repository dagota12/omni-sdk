<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Omni Analytics SDK - Web Test App</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        color: #333;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px 30px;
        text-align: center;
      }

      header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      header p {
        font-size: 1.1em;
        opacity: 0.9;
      }

      main {
        padding: 40px 30px;
      }

      section {
        margin-bottom: 40px;
      }

      section h2 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 1.5em;
        border-bottom: 2px solid #667eea;
        padding-bottom: 10px;
      }

      .info-box {
        background: #f5f7fa;
        border-left: 4px solid #667eea;
        padding: 15px 20px;
        margin-bottom: 20px;
        border-radius: 4px;
        font-size: 0.95em;
        line-height: 1.6;
      }

      .info-box strong {
        color: #667eea;
      }

      .button-group {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin-bottom: 20px;
      }

      button {
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      button.primary {
        background: #667eea;
        color: white;
      }

      button.primary:hover {
        background: #5568d3;
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
      }

      button.secondary {
        background: #f0f0f0;
        color: #333;
        border: 2px solid #ddd;
      }

      button.secondary:hover {
        background: #e8e8e8;
        border-color: #667eea;
        color: #667eea;
      }

      button.danger {
        background: #ff6b6b;
        color: white;
      }

      button.danger:hover {
        background: #ee5a52;
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(255, 107, 107, 0.3);
      }

      button:active {
        transform: translateY(0);
      }

      .event-log {
        background: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 15px;
        font-family: "Courier New", monospace;
        font-size: 0.9em;
        max-height: 400px;
        overflow-y: auto;
        line-height: 1.6;
      }

      .event-item {
        padding: 10px;
        margin-bottom: 10px;
        background: white;
        border-left: 3px solid #667eea;
        border-radius: 3px;
      }

      .event-type {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 3px;
        font-weight: bold;
        margin-right: 8px;
        font-size: 0.85em;
      }

      .event-type.pageview {
        background: #e3f2fd;
        color: #1976d2;
      }

      .event-type.click {
        background: #f3e5f5;
        color: #7b1fa2;
      }

      .event-type.custom {
        background: #e8f5e9;
        color: #388e3c;
      }

      .timestamp {
        color: #999;
        font-size: 0.85em;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
      }

      .stat-card h3 {
        font-size: 2em;
        margin-bottom: 5px;
      }

      .stat-card p {
        font-size: 0.9em;
        opacity: 0.9;
      }

      .input-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
      }

      input[type="text"],
      input[type="email"] {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 1em;
        transition: border-color 0.3s ease;
      }

      input[type="text"]:focus,
      input[type="email"]:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .status-message {
        padding: 15px;
        border-radius: 6px;
        margin-bottom: 20px;
        display: none;
      }

      .status-message.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        display: block;
      }

      .status-message.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
        display: block;
      }

      .clearable-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      footer {
        background: #f5f7fa;
        padding: 20px;
        text-align: center;
        color: #666;
        font-size: 0.9em;
        border-top: 1px solid #ddd;
      }

      @media (max-width: 768px) {
        header h1 {
          font-size: 2em;
        }

        .button-group {
          flex-direction: column;
        }

        button {
          width: 100%;
          justify-content: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üìä Omni Analytics SDK</h1>
        <p>Web Test App - Real-time Event Tracking Demo</p>
      </header>

      <main>
        <!-- Status Message -->
        <div id="statusMessage" class="status-message"></div>

        <!-- SDK Control Section -->
        <section>
          <h2>üöÄ SDK Status</h2>
          <div class="info-box">
            <strong>Status:</strong> <span id="sdkStatus">Initializing...</span>
          </div>
          <div
            class="info-box"
            style="border-left-color: #4caf50; margin-top: 10px"
          >
            <strong style="color: #4caf50">Auto-Tracking Active:</strong>
            <br />‚úì All clicks automatically tracked <br />‚úì Form submissions
            tracked <br />‚úì Page navigation tracked <br />‚úì Events auto-batched
            & queued <br />‚úì Auto-flush on page unload
          </div>
          <div class="button-group">
            <button class="secondary" onclick="showSDKInfo()">
              Show SDK Stats
            </button>
          </div>
        </section>

        <!-- User Management Section -->
        <section>
          <h2>üë§ User Management</h2>
          <div class="input-group">
            <label for="userIdInput">User ID (Optional)</label>
            <input
              type="email"
              id="userIdInput"
              placeholder="e.g., user@example.com"
            />
          </div>
          <div class="button-group">
            <button class="primary" onclick="setUserIdFromInput()">
              Set User ID
            </button>
            <button class="secondary" onclick="showCurrentUser()">
              Show Current User
            </button>
            <button class="secondary" onclick="startNewSession()">
              Start New Session
            </button>
          </div>
        </section>

        <!-- Event Tracking Section -->
        <section>
          <h2>üì° Interactive Demo</h2>
          <div class="info-box">
            üéØ Try interacting with buttons and links below. The SDK
            automatically tracks everything without any manual tracking calls!
          </div>

          <h3
            style="
              margin-top: 20px;
              margin-bottom: 15px;
              color: #555;
              font-size: 1.1em;
            "
          >
            Clickable Elements (Auto-Tracked)
          </h3>
          <div class="button-group">
            <button class="primary">Home Button</button>
            <button class="primary">Product Button</button>
            <button class="primary">Contact Button</button>
            <a
              href="#"
              class="secondary"
              style="
                text-decoration: none;
                display: flex;
                align-items: center;
                justify-content: center;
              "
              >Click This Link</a
            >
          </div>

          <h3
            style="
              margin-top: 20px;
              margin-bottom: 15px;
              color: #555;
              font-size: 1.1em;
            "
          >
            Simulate Page Navigation
          </h3>
          <div class="button-group">
            <button
              class="secondary"
              onclick="simulatePageNavigation('/home', 'Home Page')"
            >
              Go to Home
            </button>
            <button
              class="secondary"
              onclick="simulatePageNavigation('/products', 'Products Page')"
            >
              Go to Products
            </button>
            <button
              class="secondary"
              onclick="simulatePageNavigation('/about', 'About Page')"
            >
              Go to About
            </button>
          </div>

          <h3
            style="
              margin-top: 20px;
              margin-bottom: 15px;
              color: #555;
              font-size: 1.1em;
            "
          >
            Track Custom Events
          </h3>
          <div class="button-group">
            <button
              class="secondary"
              onclick="trackCustomEvent('user_signup', {source: 'web-test'})"
            >
              Track Sign Up
            </button>
            <button
              class="secondary"
              onclick="trackCustomEvent('purchase_complete', {amount: 99.99, currency: 'USD'})"
            >
              Track Purchase
            </button>
            <button
              class="secondary"
              onclick="trackCustomEvent('feature_used', {feature: 'analytics_dashboard'})"
            >
              Track Feature Use
            </button>
          </div>
        </section>

        <!-- Statistics Section -->
        <section>
          <div class="clearable-section">
            <h2>üìà Statistics</h2>
            <button class="secondary" onclick="clearEventLog()">
              Clear Log
            </button>
          </div>
          <div class="stats">
            <div class="stat-card">
              <h3 id="totalEvents">0</h3>
              <p>Total Events</p>
            </div>
            <div class="stat-card">
              <h3 id="pageViewCount">0</h3>
              <p>Page Views</p>
            </div>
            <div class="stat-card">
              <h3 id="clickCount">0</h3>
              <p>Clicks</p>
            </div>
            <div class="stat-card">
              <h3 id="customCount">0</h3>
              <p>Custom Events</p>
            </div>
          </div>
        </section>

        <!-- Event Log Section -->
        <section>
          <h2>üìã Event Log</h2>
          <div class="info-box">
            <strong>Real-time Event Stream:</strong> All tracking events appear
            below as they occur. The SDK is logging all user interactions with
            timestamps and session information.
          </div>
          <div class="event-log" id="eventLog">
            <div
              class="event-item"
              style="border-left-color: #999; color: #999"
            >
              Events will appear here as you interact with the page...
            </div>
          </div>
        </section>

        <!-- Actions Section -->
        <section>
          <h2>‚öôÔ∏è Session & Queue Management</h2>
          <div class="button-group">
            <button class="primary" onclick="flushEvents()">
              Flush Queued Events
            </button>
            <button class="secondary" onclick="showCurrentUser()">
              Show Session ID
            </button>
            <button class="secondary" onclick="startNewSession()">
              Start New Session
            </button>
          </div>
        </section>
      </main>

      <footer>
        <p>
          üß™ This is a test application to demonstrate Omni Analytics SDK
          functionality
        </p>
        <p>Events are queued and would be sent to the configured endpoint</p>
      </footer>
    </div>

    <!-- SDK Bundle -->
    <script type="module">
      // REAL-WORLD USAGE: Just import and initialize - that's it!
      // The SDK handles everything automatically

      import { initializeSDK } from "/dist/index.esm.js";

      let eventLogInstance = [];
      let stats = {
        total: 0,
        pageview: 0,
        click: 0,
        custom: 0,
      };

      // ============================================
      // INITIALIZATION - User just does this once
      // ============================================
      const { tracker } = initializeSDK({
        projectId: "web-test-project",
        endpoint: "http://localhost:3000/api/events",
        debug: true,
        batchSize: 5,
        batchTimeout: 10000,
      });

      console.log("‚úÖ SDK Initialized! All tracking is now automatic.");
      updateStatus("‚úÖ SDK initialized! Auto-tracking is active.", "success");
      document.getElementById("sdkStatus").textContent =
        "‚úÖ Ready (Auto-tracking enabled)";

      // ============================================
      // Track initial page load
      // ============================================
      tracker.trackPageView({
        route: "/",
        title: "Web Test App - Real Usage Demo",
        isInitialLoad: true,
      });
      stats.total++;
      stats.pageview++;
      updateStats();
      logEvent("pageview", {
        route: "/",
        title: "Web Test App",
        isInitialLoad: true,
      });

      // ============================================
      // AUTO-TRACK: All clicks (no manual tracking needed!)
      // ============================================
      document.addEventListener(
        "click",
        (event) => {
          const target = event.target.closest('button, a, [role="button"]');
          if (target) {
            tracker.trackClick(target, {
              pageX: event.pageX,
              pageY: event.pageY,
            });
            stats.total++;
            stats.click++;
            updateStats();
            logEvent("click", {
              element: target.tagName.toLowerCase(),
              text: target.textContent.substring(0, 50),
              coordinates: { x: event.pageX, y: event.pageY },
            });
          }
        },
        true
      );

      // ============================================
      // AUTO-TRACK: Form submissions
      // ============================================
      document.addEventListener(
        "submit",
        (event) => {
          const form = event.target;
          tracker.trackCustom("form_submitted", {
            formId: form.id || "unknown",
            formName: form.name || "unknown",
            fieldCount: form.querySelectorAll("input, textarea, select").length,
          });
          stats.total++;
          stats.custom++;
          updateStats();
          logEvent("custom", {
            eventName: "form_submitted",
            formId: form.id,
          });
        },
        true
      );

      // ============================================
      // AUTO-TRACK: Page changes (SPA navigation)
      // ============================================
      window.addEventListener("popstate", () => {
        tracker.trackPageView({
          route: window.location.pathname,
          title: document.title,
          isInitialLoad: false,
        });
        stats.total++;
        stats.pageview++;
        updateStats();
        logEvent("pageview", {
          route: window.location.pathname,
          title: document.title,
          trigger: "popstate",
        });
      });

      // ============================================
      // AUTO-TRACK: Unload (send remaining events)
      // ============================================
      window.addEventListener("beforeunload", () => {
        tracker.trackCustom("page_unload", {
          totalEventsTracked: stats.total,
          sessionDuration: Math.floor(performance.now() / 1000),
        });
        tracker.flush().catch(() => {
          // Silently fail if backend not available
        });
      });

      // ============================================
      // User Actions - Optional Manual Tracking
      // ============================================

      function setUserIdFromInput() {
        const userId = document.getElementById("userIdInput").value.trim();
        if (!userId) {
          updateStatus("Please enter a user ID.", "error");
          return;
        }
        tracker.setUserId(userId);
        updateStatus(`üë§ User ID set to: ${userId}`, "success");
        logEvent("system", { action: "setUserId", userId });
      }

      function showCurrentUser() {
        const sessionId = tracker.getSessionId();
        updateStatus(`üìå Current Session ID: ${sessionId}`, "success");
      }

      function startNewSession() {
        const newSessionId = tracker.newSession();
        updateStatus(`üîÑ New session started: ${newSessionId}`, "success");
        logEvent("system", { action: "newSession", sessionId: newSessionId });
      }

      async function flushEvents() {
        try {
          updateStatus("üîÑ Flushing all queued events...", "success");
          await tracker.flush();
          updateStatus("‚úÖ Events flushed successfully!", "success");
          logEvent("system", { action: "flushEvents", success: true });
        } catch (error) {
          updateStatus(
            `‚ö†Ô∏è Flush attempted (server may not be running)`,
            "success"
          );
          logEvent("system", { action: "flushEvents", error: error.message });
        }
      }

      function simulatePageNavigation(route, title) {
        tracker.trackPageView({
          route,
          title,
          isInitialLoad: false,
        });
        stats.total++;
        stats.pageview++;
        updateStats();
        logEvent("pageview", { route, title, manual: true });
        updateStatus(`üìÑ Navigation tracked: ${title}`, "success");
      }

      function trackCustomEvent(eventName, properties) {
        tracker.trackCustom(eventName, properties);
        stats.total++;
        stats.custom++;
        updateStats();
        logEvent("custom", { eventName, properties });
        updateStatus(`‚ú® Custom event tracked: ${eventName}`, "success");
      }

      function showSDKInfo() {
        const info = `
üìä SDK STATISTICS:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ Status: SDK Initialized
üì° Total Events Tracked: ${stats.total}
üìÑ Page Views: ${stats.pageview}
üñ±Ô∏è Clicks: ${stats.click}
‚ú® Custom Events: ${stats.custom}

üîÑ AUTO-TRACKING ENABLED:
  ‚úì All clicks tracked automatically
  ‚úì Form submissions tracked
  ‚úì Page navigation tracked
  ‚úì Page unload tracked
  ‚úì Events auto-batched & queued
      `;
        alert(info);
      }

      function destroySDKInstance() {
        // In real SDK, this would need to be exported
        updateStatus("‚ùå SDK cleanup (in production)", "error");
        logEvent("system", { action: "destroySDK" });
      }

      function logEvent(type, data) {
        const eventLog = document.getElementById("eventLog");
        const timestamp = new Date().toLocaleTimeString("en-US", {
          hour12: true,
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
          fractionalSecondDigits: 3,
        });

        const eventItem = document.createElement("div");
        eventItem.className = "event-item";

        let typeClass = "custom";
        if (type === "pageview") typeClass = "pageview";
        if (type === "click") typeClass = "click";

        eventItem.innerHTML = `
        <span class="event-type ${typeClass}">${type.toUpperCase()}</span>
        <span class="timestamp">${timestamp}</span>
        <br/>
        <code>${JSON.stringify(data, null, 2)}</code>
      `;

        // Replace placeholder text if it exists
        if (
          eventLog.children.length === 1 &&
          eventLog.textContent.includes("Events will appear")
        ) {
          eventLog.innerHTML = "";
        }

        eventLog.insertBefore(eventItem, eventLog.firstChild);

        // Keep only last 50 events
        while (eventLog.children.length > 50) {
          eventLog.removeChild(eventLog.lastChild);
        }

        eventLogInstance.push(data);
      }

      function updateStats() {
        document.getElementById("totalEvents").textContent = stats.total;
        document.getElementById("pageViewCount").textContent = stats.pageview;
        document.getElementById("clickCount").textContent = stats.click;
        document.getElementById("customCount").textContent = stats.custom;
      }

      function updateStatus(message, type) {
        const statusEl = document.getElementById("statusMessage");
        statusEl.textContent = message;
        statusEl.className = `status-message ${type}`;

        // Auto-hide after 4 seconds
        setTimeout(() => {
          statusEl.className = "status-message";
        }, 4000);
      }

      function clearEventLog() {
        const eventLog = document.getElementById("eventLog");
        eventLog.innerHTML =
          '<div class="event-item" style="border-left-color: #999; color: #999;">Event log cleared. New events will appear here...</div>';
        eventLogInstance = [];
        updateStatus("‚ú® Event log cleared", "success");
      }

      // Expose functions to global scope for button onclick handlers
      window.setUserIdFromInput = setUserIdFromInput;
      window.showCurrentUser = showCurrentUser;
      window.startNewSession = startNewSession;
      window.flushEvents = flushEvents;
      window.simulatePageNavigation = simulatePageNavigation;
      window.trackCustomEvent = trackCustomEvent;
      window.showSDKInfo = showSDKInfo;
      window.destroySDKInstance = destroySDKInstance;
      window.clearEventLog = clearEventLog;
    </script>
  </body>
</html>
